# üîí Security & Credentials Policy

> **‚ö†Ô∏è OUTDATED DOCUMENTATION**: This document describes advertising platform integrations (Meta, TikTok, Twitter, Snapchat, Reddit, Google Ads) that have been removed from this starter kit. This file is kept for historical reference only.

## ‚ö†Ô∏è CRITICAL: No Credentials in This Repository

This repository (`dentia`) is shared among multiple developers and **MUST NOT** contain any actual credentials, API keys, secrets, or tokens.

---

## üìç Where Credentials Are Stored

### ‚úÖ Approved Locations

1. **Local Development**:
   - `apps/frontend/.env.local` (gitignored)
   - `.env` (gitignored)  
   - Generated by setup scripts from `dentia-infra`

2. **Production**:
   - AWS SSM Parameter Store (encrypted)
   - Private `dentia-infra` repository (restricted access)

3. **Team Access**:
   - Shared securely via 1Password or similar
   - Never via Slack, email, or other insecure channels

### ‚ùå Never Commit

- `.env` files with actual values
- Any file containing real API keys, secrets, or tokens
- Scripts with hardcoded credentials
- Documentation with actual secrets
- Database passwords
- Stripe keys (live or test)
- OAuth secrets
- JWT secrets

---

## üîë Credentials Managed by This Project

### Platform API Keys

All stored in private `dentia-infra` repository:

1. **Meta/Facebook** - App ID & Secret
2. **TikTok** - Client keys (production & sandbox)
3. **Twitter/X** - API keys, tokens, secrets
4. **Google Ads** - Developer token
5. **Snapchat** - OAuth client ID, API tokens
6. **Reddit** - App ID & secret
7. **GoHighLevel** - API key, Location ID, Widget ID, Calendar ID

### Payment & Billing

8. **Stripe** - Publishable & secret keys (live & test), webhook secrets

### Authentication & Infrastructure

9. **Cognito** - User Pool ID, Client ID & Secret
10. **Database** - Connection strings with passwords
11. **NextAuth** - Secret tokens
12. **S3** - Bucket names & access keys

---

## üöÄ Setup For Developers

### New Developer Onboarding

1. **Get access to `dentia-infra` repository** (request from team lead)

2. **Run setup script**:
   ```bash
   cd /Users/shaunk/Projects/Dentia/dentia-infra
   ./infra/scripts/setup-local-env.sh
   ```

3. **Start development**:
   ```bash
   cd ../dentia
   docker-compose up
   ```

### For Specific Platforms

**Platform Keys** (Meta, TikTok, Twitter, etc.):
```bash
cd dentia-infra
./infra/scripts/setup-local-env.sh
```

**GoHighLevel**:
```bash
# Credentials are included in setup-local-env.sh
# Or set manually:
export GHL_API_KEY="get-from-team-lead"
export GHL_LOCATION_ID="get-from-team-lead"
export NEXT_PUBLIC_GHL_WIDGET_ID="get-from-team-lead"
export NEXT_PUBLIC_GHL_CALENDAR_ID="get-from-team-lead"
```

---

## üõ°Ô∏è Scripts & Tools

### Safe Scripts (No Hardcoded Credentials)

These scripts in `dentia` are safe - they fetch credentials from environment or AWS SSM:

| Script | What It Does | Credentials Source |
|--------|--------------|-------------------|
| `build-frontend-docker.sh` | Build Docker images | AWS SSM or env vars |
| `deploy-migrations.sh` | Deploy DB migrations | AWS SSM |
| `deploy-production-migrations-via-bastion.sh` | Deploy via bastion | AWS SSM |
| `connect-production-db.sh` | Connect to prod DB | AWS SSM (via bastion) |
| `migrate-and-start.sh` | Run migrations on startup | Environment variables |

### Setup Scripts (Have Credentials - In Private Repo Only)

These scripts in `dentia-infra` contain actual credentials:

| Script | Location | Purpose |
|--------|----------|---------|
| `setup-local-env.sh` | dentia-infra/infra/scripts/ | Local dev setup |
| `put-ssm-secrets.sh` | dentia-infra/infra/scripts/ | Production deployment |
| `put-ssm-secrets-dev.sh` | dentia-infra/infra/scripts/ | Dev environment |

---

## üö® If Credentials Are Accidentally Committed

### Immediate Actions

1. **DO NOT push** if you haven't yet
2. **Remove from staging**: `git reset HEAD <file>`
3. **If already pushed**:
   - Immediately notify team lead/security
   - Revoke/rotate the exposed credentials
   - Update all environments with new credentials

### Credential Rotation Procedures

#### Platform Keys (Meta, TikTok, etc.)

1. Generate new keys in the platform dashboard
2. Update in `dentia-infra/infra/scripts/put-ssm-secrets.sh`
3. Run `./put-ssm-secrets.sh` to update AWS SSM
4. Notify team to run `setup-local-env.sh` for local updates
5. Revoke old keys after verification

#### GoHighLevel

1. Log in to GHL ‚Üí Settings ‚Üí Company ‚Üí API Keys
2. Delete exposed key
3. Generate new key
4. Update in `dentia-infra/infra/scripts/put-ssm-secrets.sh`
5. Deploy to AWS SSM and notify team

#### Stripe

1. Log in to Stripe Dashboard
2. Revoke exposed keys
3. Generate new keys
4. Update in `dentia-infra/infra/scripts/put-ssm-secrets.sh`
5. Deploy immediately to production

#### Database Passwords

1. **CRITICAL**: Rotate immediately via AWS RDS console
2. Update in `dentia-infra/infra/scripts/put-ssm-secrets.sh`
3. Deploy to AWS SSM
4. Restart all services to pick up new credentials

---

## ‚úÖ Pre-Commit Checklist

Before committing, always verify:

```bash
# 1. Check what you're committing
git status
git diff --cached

# 2. Search for potential secrets
git diff --cached | grep -iE "api.*key|secret|password|token|sk_|pk_|whsec"

# 3. Check for specific patterns
git diff --cached | grep -E "pit-[a-z0-9]|sk_live_|pk_live_|whsec_"

# 4. If you find any, unstage immediately
git reset HEAD <file>
```

---

## üìã Environment Variable Naming

### Server-Side Only (Never Exposed)

```bash
GHL_API_KEY=secret-value
STRIPE_SECRET_KEY=sk_live_...
DATABASE_URL=postgresql://...
META_APP_SECRET=secret
COGNITO_CLIENT_SECRET=secret
NEXTAUTH_SECRET=secret
```

### Client-Side Safe (Can Be Public)

```bash
NEXT_PUBLIC_GHL_WIDGET_ID=widget-id
NEXT_PUBLIC_GHL_CALENDAR_ID=calendar-id
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_live_...
NEXT_PUBLIC_APP_URL=https://app.dentiaapp.com
```

**Rule**: Only use `NEXT_PUBLIC_*` if it's safe to expose publicly!

---

## üìö Documentation Standards

### ‚úÖ Good Examples (Use These)

```bash
# Good - placeholder
STRIPE_SECRET_KEY=your-secret-key-here

# Good - instruction
# Get from: dentia-infra repo or AWS SSM

# Good - reference
# Stored in /dentia/shared/STRIPE_SECRET_KEY
```

### ‚ùå Bad Examples (Never Do This)

```bash
# Bad - actual credential
STRIPE_SECRET_KEY=sk_live_51SNPE0F4uIWy...

# Bad - real token  
GHL_API_KEY=pit-8a1eae7c-9011-479c...

# Bad - any real value
DATABASE_PASSWORD=actual-password
```

---

## üîç Code Review Checklist

Reviewers should check:

- [ ] No hardcoded credentials in any file
- [ ] All examples use placeholders
- [ ] Documentation refers to proper credential sources
- [ ] `.gitignore` includes all sensitive files
- [ ] No accidentally committed `.env` files
- [ ] Scripts fetch credentials from SSM or environment
- [ ] No database passwords in scripts
- [ ] No API keys in code comments

---

## üë• Team Responsibilities

### Developers

- Never commit credentials
- Keep `.env` files secure
- Don't share credentials via insecure channels
- Report any security concerns immediately
- Use `dentia-infra` scripts for setup

### Team Leads

- Provide credentials securely to new developers
- Grant access to `dentia-infra` repository
- Maintain credential documentation in private repo
- Rotate credentials regularly
- Review code for security issues

### Admins

- Manage AWS SSM parameters
- Control access to `dentia-infra` repository
- Monitor for credential exposure
- Implement and enforce security policies
- Maintain credential rotation schedule

---

## üìñ Related Documentation

- [GoHighLevel Security](./docs/GOHIGHLEVEL_SECURITY.md)
- [GoHighLevel Setup](./docs/GOHIGHLEVEL_YOUR_CREDENTIALS.md)
- [Platform Keys Setup](./scripts/README_PLATFORM_SETUP.md)
- [GHL Setup Instructions](./scripts/README_GHL_SETUP.md)

---

## ‚úÖ Current Security Status

- ‚úÖ All credentials removed from `dentia` repository
- ‚úÖ Setup scripts moved to private `dentia-infra`
- ‚úÖ Build scripts fetch from AWS SSM or env vars
- ‚úÖ Templates and placeholders in place
- ‚úÖ Documentation updated
- ‚úÖ `.gitignore` configured properly
- ‚úÖ Security guidelines documented

---

## üîê Security Tools & Practices

### Git Hooks (Recommended)

Install git-secrets to prevent committing credentials:

```bash
# Install git-secrets
brew install git-secrets  # macOS
# or
git clone https://github.com/awslabs/git-secrets.git
cd git-secrets && make install

# Set up for this repo
cd /path/to/dentia
git secrets --install
git secrets --register-aws
git secrets --add 'sk_live_[a-zA-Z0-9]+'
git secrets --add 'pk_live_[a-zA-Z0-9]+'
git secrets --add 'whsec_[a-zA-Z0-9]+'
git secrets --add 'pit-[a-z0-9-]+'
```

### Pre-commit Hook

Create `.git/hooks/pre-commit`:

```bash
#!/bin/bash
if git diff --cached | grep -iE "sk_live_|pk_live_|whsec_|pit-[a-z0-9-]+|password.*=.*[^placeholder]"; then
  echo "‚õî ERROR: Potential credential found in staged files!"
  echo "Please remove credentials before committing."
  exit 1
fi
```

---

**Questions?** Contact your team lead or admin.

**Security Issue?** Report immediately - don't wait!

**Last Updated**: November 2024  
**Policy Owner**: Security Team  
**Review Frequency**: Quarterly
